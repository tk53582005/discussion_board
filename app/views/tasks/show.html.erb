<h1><%= @task.title %></h1>

<% if @task.eyecatch.attached? %>
  <%= image_tag @task.eyecatch, style: "max-width: 100%; height: auto;" %>
<% end %>

<p><%= @task.content %></p>
<p>期限: <%= @task.due_date.strftime("%Y年%m月%d日") %></p>
<p>担当者: <%= @task.user.email %></p>
<p>作成日: <%= @task.created_at.strftime("%Y年%m月%d日 %H:%M") %></p>

<% if @task.user == current_user %>
  <%= link_to "編集", edit_board_task_path(@board, @task) %>
  <%= link_to "削除", board_task_path(@board, @task), data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" } %>
<% end %>

<hr>

<h2>コメント</h2>

<!-- コメント投稿フォーム -->
<%= form_with model: [@board, @task, Comment.new], local: true do |f| %>
  <div>
    <%= f.label :content, "コメント内容" %>
    <%= f.text_area :content, rows: 3, placeholder: "コメントを入力してください" %>
  </div>
  <div>
    <%= f.submit "コメントする" %>
  </div>
<% end %>

<hr>

<!-- コメント一覧 -->
<% if @task.comments.any? %>
  <% @task.comments.order(created_at: :desc).each do |comment| %>
    <div>
      <p><strong><%= comment.user.email %></strong> - <%= comment.created_at.strftime("%Y年%m月%d日 %H:%M") %></p>
      <p><%= comment.content %></p>
      
      <% if comment.user == current_user %>
        <%= link_to "削除", board_task_comment_path(@board, @task, comment), data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" } %>
      <% end %>
    </div>
    <hr>
  <% end %>
<% else %>
  <p>まだコメントはありません</p>
<% end %>

<%= link_to "ボードに戻る", board_path(@board) %>